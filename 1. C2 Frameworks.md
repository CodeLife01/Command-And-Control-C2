# C2 Frameworks

## Overview:

**C2 Frameworks** (Command and Control frameworks) are tools used to manage communication between an operator and a compromised target during a cyberattack or security test. These frameworks enable an adversary or red team to remotely control and maintain persistent access to a compromised system.

### Key Aspects of C2 Frameworks:

1. **Communication Channels**: C2 frameworks often use covert communication channels to send commands and receive data. These channels can include HTTP/S, DNS, ICMP, and other protocols, making it difficult to detect by defensive measures.
2. **Persistence**: C2 frameworks are designed to maintain persistence on the compromised system, allowing an attacker to re-establish communication even after network disruptions or reboots.
3. **Modularity**: C2 frameworks offer modular capabilities, including post-exploitation modules for actions like privilege escalation, lateral movement, exfiltration, and more.
4. **Obfuscation**: These tools often employ encryption, encoding, or other obfuscation techniques to avoid detection by security tools such as firewalls, intrusion detection systems (IDS), or endpoint protection.
5. **Automation**: Many C2 frameworks allow for automation of tasks, such as scanning for vulnerabilities, executing payloads, and collecting sensitive information from multiple systems.
6. **Payload Deployment**: C2 frameworks allow operators to deliver payloads such as malware, ransomware, or additional exploitation tools to compromised systems.

### Use by Adversaries:

- **Persistence and Lateral Movement**: Once adversaries gain initial access to a network or system, they use C2 frameworks to maintain communication with infected systems and further move laterally within a network.
- **Data Exfiltration**: C2 frameworks enable the attackers to steal data, monitor keystrokes, or collect sensitive information from compromised systems.
- **Reconnaissance and Enumeration**: Adversaries can issue commands to gather information about the internal network, connected devices, user accounts, and active processes.

### Use by Red Teams:

- **Simulating Advanced Threats**: Red teams use C2 frameworks to simulate real-world cyberattacks and help organizations understand how an adversary might operate. They use them in controlled environments for security testing.
- **Tactics, Techniques, and Procedures (TTPs)**: Red teams use C2 tools to replicate the TTPs of known threat actors, providing an organization with valuable insights into how well their defenses hold up.
- **Post-exploitation Activities**: After successfully compromising a target during a red team assessment, C2 frameworks enable red teamers to execute further attacks or achieve assessment objectives (e.g., exfiltrating sensitive data).

### Common C2 Frameworks:

- **Cobalt Strike**: A popular framework among both red teams and threat actors, offering a variety of post-exploitation capabilities like lateral movement and data exfiltration, with a stealthy communication profile.
- **PowerShell Empire**: A post-exploitation framework leveraging PowerShell, widely used for running agents on compromised systems. Known for its modular approach and flexibility.
- **Sliver**: An open-source adversary emulation framework, which provides implants for cross-platform exploitation (Linux, Windows, macOS). It's often used as an alternative to Cobalt Strike.
- **Mythic**: An open-source C2 framework designed for flexibility and ease of use. It allows users to create and deploy custom payloads in multiple languages (such as Python, PowerShell, Go) and provides an intuitive web-based interface. Mythic is particularly noted for its modularity and customization capabilities, making it a versatile choice for red teams.

**Mythic** stands out due to its support for custom agents ("payloads"), offering significant control over the behavior and appearance of the agents on the target systems, which helps in simulating real-world threats more effectively.

### **Components of a C2 Framework**

In order to understand a C2 framework, we must first start by understanding the various components of a C2 framework. 

- **C2 Server.** The C2 Server serves as a hub for agents to call back to. Agents/Payloads will periodically reach out to the C2 server and wait for the operator’s commands.
- **Listeners**. Similar to the way we ran  `nc -lvnp 1337`in previous labs, listeners are just applications running on the server that are waiting for a connection on a specific port or protocol. You’ll likely hear about HTTP(S) and DNS the most.
- **Implants/Agents/Payloads.** They go by different names depending on the framework, but these are the actual programs that you run on a target computer to get the remote connection back on your C2 server. They can come in many different forms, such as binaries, shellcode, PowerShell commands, or quite frankly just any type of code execution, but getting these programs to run are the key to taking advantage of the C2 framework.
- **Beacons.** A Beacon is the process of a C2 Agent calling back to the listener running on a C2 Server.

Most frameworks will also have some kind of staging options, post-exploitation modules, multi-user capabilities, etc., but the core pieces are mentioned above. Our goal in the next few videos is just to understand the basics (and maybe a little bit more) of Mythic, PowerShell Empire and Sliver, which should be applicable for any other C2 framework.

### **Obfuscating Agent/Payload Callbacks**

One key thing that security analysts, anti-virus, and next-generation firewalls look for when attempting to identify Command and Control traffic is the rate at which a device beacons out to a C2 server. For example, a firewall may log the following sessions:

- TCP/443 - Session Duration 3s, 55 packets sent, 10:00:05.000
- TCP/443 - Session Duration 2s, 33 packets sent, 10:00:10.000
- TCP/443 - Session Duration 3s, 55 packets sent, 10:00:15.000
- TCP/443 - Session Duration 1s, 33 packets sent, 10:00:20.000
- TCP/443 - Session Duration 3s, 55 packets sent, 10:00:25.000

A pattern is starting to form. The agent beacons out every 5 seconds; this means that it has a sleep timer of 5 seconds.

### **Jitter**

C2 Frameworks, including Sliver, now include a feature named jitter. Jitter takes the sleep timer and adds some variation to it; our C2 beaconing may now exhibit a strange pattern that may show activity that is closer to an average user:

- TCP/443 - Session Duration 3s, 55 packets sent, 10:00:03.580
- TCP/443 - Session Duration 2s, 33 packets sent, 10:00:13.213
- TCP/443 - Session Duration 3s, 55 packets sent, 10:00:14.912
- TCP/443 - Session Duration 1s, 33 packets sent, 10:00:23.444
- TCP/443 - Session Duration 3s, 55 packets sent, 10:00:27.182

The beaconing is now set at a semi-irregular pattern that makes it slightly more difficult to identify among regular user traffic. In more advanced C2 frameworks, it may be possible to alter various other parameters, like “File” jitter or adding junk data to the payload or files being transmitted to make it seem larger than it actually is.

